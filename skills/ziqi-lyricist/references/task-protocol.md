## 任务协议（Task-first）

### 1. 创建父任务

开始写词前，先创建父任务：
- 名称：`{song} 歌词创作任务`
- 目标：在多轮迭代后交付用户确认的最终歌词

### 2. 创建子任务（固定映射）

按以下映射创建 10 个子任务：

- T1 -> 步骤1 启动检查
- T2 -> 步骤2 情感核心提取
- T3 -> 步骤3 建立禁用清单
- T4 -> 步骤4 主题与词眼确认
- T5 -> 步骤5 检索意象库
- T6 -> 步骤6 表现手法选择
- T7 -> 步骤7 分段创作
- T8 -> 步骤8 质量自检
- T9 -> 步骤9 展示与确认
- T10 -> 步骤10 保存与交接

### 3. 状态规则

每个子任务必须标记状态：
- `pending`
- `in_progress`
- `completed`
- `blocked`

执行规则：
- 同一时刻只能有 1 个 `in_progress`。
- 未完成当前任务前，不跳到下一任务。

### 4. 多轮调整规则（重点）

用户提出修改意见时：

1. 不新建父任务。
2. 在当前父任务下追加修订子任务：
   - 例：`T7-R2 分段创作修订`
   - 例：`T8-R2 质量复检`
   - 例：`T9-R2 二次确认`
3. 保留每轮变更摘要（改了什么、为什么改）。
4. 用户未确认前，父任务保持进行中。

### 5. 完成条件

仅当满足以下条件，父任务才可标记完成：

- 用户明确确认最终歌词
- 格式校验通过
- 质量门禁通过
- 歌词文件已保存
- 已给出交接说明（进入 ziqi-producer）

### 6. 推荐任务模板

```text
父任务：{song} 歌词创作任务 [in_progress]
- T1 启动检查 [completed]
- T2 情感核心提取 [completed]
- T3 禁用清单 [completed]
- T4 主题词眼确认 [completed]
- T5 意象检索 [completed]
- T6 手法选择 [completed]
- T7 分段创作 [completed]
- T8 质量自检 [completed]
- T9 用户确认 [in_progress]
- T10 保存与交接 [pending]

修订轮次（如有）：
- T7-R2 分段创作修订 [completed]
- T8-R2 质量复检 [completed]
- T9-R2 二次确认 [in_progress]
```
