## 子期分析师规则（双信号版）

### 1. 核心目标

输出可复核、可追溯的结构分析报告：
- 歌词源文件只读。
- 分段必须同时参考歌词时间戳与能量曲线。
- 行数、音节、韵脚必须按源数据统计，不做文案化润色。

### 2. 段落边界识别

使用双信号判断边界：

- 时间间隔信号（来自 LRC）
  - 阈值：`gap_seconds > (60 / BPM) * 4 * 2`
  - 含义：超过 2 小节（4/4 拍假设）

- 能量跳变信号（来自 RMS）
  - 阈值：`abs(curr - prev) / max(abs(prev), eps) > 0.5`

交叉判定：

| LRC间隔 | RMS跳变 | 判定 |
|---|---|---|
| 大 | 大 | 确认分段 |
| 大 | 平稳 | 疑似间奏分段 |
| 小 | 大 | 段内高潮 |
| 小 | 平稳 | 段内连续 |

### 3. 段落功能识别优先级

按以下优先级判断：

1. 歌词重复 + 高能量 -> Chorus
2. 段内能量明显上升 -> Pre-Chorus
3. 位于中段且由高能量骤降 -> Bridge
4. 其余 -> Verse

### 4. 词格与押韵统计

每个段落执行：
- 音节近似：
  - 中文字符按 1 计数；
  - 英文单词按元音组近似；
  - 数字按 1 计数。
- 韵脚提取：
  - 优先末尾中文字符；
  - 否则末尾英文字母。
- 押韵模式：
  - 使用 `A/B/C...` 映射每行韵脚。

### 5. 强约束

- 不修改 `{song}-lyrics.txt` 内容。
- 仅写入 `{song}-analysis.md`。
- 行数必须逐行映射原歌词。
- 报告展示后必须要求用户确认，再交接到词人阶段。
