# 企业级 Agent 实战路线图：写小说系统（3 个月）

---

## 目标

用 LangChain + LangGraph 构建一个写小说 Agent，通过真实场景练习企业级 Agent 的核心能力。

**MVP 目标**：输入题材、人物设定、剧情大纲 → 输出 3000-5000 字短篇小说

---

## 阶段 0：现状盘点与场景设计（第 1 周）

**目标**：明确能力现状，设计 MVP 场景

**要做的事**：
1. 盘点现有能力
   - 你现在用 LangChain 写过什么 Agent？
   - 能做到什么程度？（单轮/多轮、有无工具调用、有无状态管理）
   - 遇到过什么问题？

2. 设计 MVP 场景
   - 输入：题材（如"科幻"）、人物设定（2-3 个角色）、剧情大纲（3-5 句话）
   - 输出：短篇小说（3000-5000 字）
   - 不做：长篇、复杂的多线叙事、自动生成人物设定

3. 搭建最简单的版本
   - 用 LangChain 写一个能跑的 Demo
   - 不管质量，先跑通：输入 → LLM 生成 → 输出

**产出**：
- 能力现状文档（你现在会什么、不会什么）
- MVP 场景设计文档（输入输出格式、不做什么）
- 最简 Demo（能跑，但质量差）

**判断标准**：
- Demo 能生成一篇文本（哪怕质量很差）
- 你知道这个 Demo 的问题在哪

---

## 阶段 1：上下文管理（第 2-3 周）

**目标**：让 Agent 记住设定和已写内容

**现在的问题**：
- 最简 Demo 生成的小说前后矛盾（人物名字变了、剧情忘了）
- 因为没有状态管理

**要做的事**：
1. 设计状态结构
   - 人物设定：名字、性格、关系
   - 剧情大纲：起因、经过、高潮、结局
   - 已写内容：已生成的段落

2. 实现状态管理
   - 用 LangChain 的 Memory（ConversationBufferMemory 或 ConversationSummaryMemory）
   - 或者用 LangGraph 的 State

3. 让 Agent 在生成时能访问状态
   - 生成每一段时，Prompt 里包含：人物设定 + 剧情大纲 + 已写内容

**产出**：
- 状态结构设计文档
- 能记住设定的 Agent（生成的小说前后一致）

**判断标准**：
- 生成的小说里，人物名字不会变
- 剧情能按大纲推进

---

## 阶段 2：观测性（第 4-5 周）

**目标**：看清 Agent 每一步在做什么

**现在的问题**：
- Agent 生成的小说质量不稳定
- 不知道是 Prompt 的问题、还是状态管理的问题、还是 LLM 的问题

**要做的事**：
1. 记录每一步的输入输出
   - 每次调用 LLM 时，记录：Prompt、输入的状态、LLM 返回的内容
   - 用结构化日志（JSON 格式）

2. 实现任务回放
   - 给定一个任务 ID，能重新看到这个任务的每一步
   - 包括：输入、状态、Prompt、输出

3. 统计指标
   - 成功率：生成的小说是否符合要求（至少能判断字数、是否完整）
   - Token 消耗：每次生成用了多少 Token

**产出**：
- 结构化日志示例
- 任务回放功能演示
- 指标统计报告

**判断标准**：
- 给定一个任务，能看到每一步的 Prompt 和输出
- 能统计出成功率和 Token 消耗

---

## 阶段 3：迭代优化（第 6-7 周）

**目标**：根据观测结果优化 Agent

**现在的问题**：
- 有了观测性，能看到问题，但不知道怎么改

**要做的事**：
1. 分析失败案例
   - 找出生成质量差的任务
   - 看日志，找到问题：是 Prompt 不清楚？是状态管理有 bug？是 LLM 能力不够？

2. 优化 Prompt
   - 根据失败案例，调整 Prompt
   - 比如：加更明确的指令、加示例、调整格式

3. 优化状态管理
   - 如果发现状态管理有问题（比如已写内容太长导致超 Token），优化状态结构
   - 比如：只保留最近 N 段、或者用摘要代替全文

4. 建立反馈循环
   - 改完之后，重新跑之前失败的案例
   - 看成功率是否提升

**产出**：
- 失败案例分析报告
- 优化前后的对比（成功率、生成质量）

**判断标准**：
- 至少完成一轮优化
- 成功率有提升（哪怕只提升 10%）

---

## 阶段 4：整合交付（第 8-10 周）

**目标**：整合所有模块，做一个可演示的完整系统

**要做的事**：
1. 完整流程跑通
   - 输入设定 → Agent 规划章节 → 逐段生成 → 输出完整小说
   - 确保状态管理、观测性、迭代优化都在

2. 加基础的版本管理
   - 生成过程中，保存每一段的版本
   - 如果某一段不满意，能回退重新生成

3. 准备演示材料
   - 架构图：Agent 的模块结构、数据流
   - 案例：输入 → 输出，展示生成的小说
   - 日志：展示观测性和迭代优化的效果

**产出**：
- 完整的写小说 Agent（可运行、可演示）
- 演示材料（架构图、案例、日志）

**判断标准**：
- 能从头到尾跑通一个完整的小说生成任务
- 有至少 3 个成功案例可展示

---

## 阶段 5：文档与总结（第 11-12 周）

**目标**：整理文档，准备面试展示

**要做的事**：
1. 清理代码
   - 删掉调试代码、临时文件
   - 加必要的注释（只在关键逻辑处）

2. 写项目文档
   - 项目介绍：做了什么、解决了什么问题
   - 架构设计：模块划分、数据流
   - 核心能力：上下文管理、观测性、迭代优化的具体实现
   - 失败案例与优化：展示你的问题分析和解决能力

3. 准备面试材料
   - 5 分钟介绍：项目背景、核心能力、亮点
   - 10 分钟演示：跑一个完整案例，展示日志和优化效果
   - 准备常见问题的回答：为什么这样设计、遇到过什么坑、如何优化

**产出**：
- 完整项目文档
- 面试演示材料

**判断标准**：
- 文档能让别人看懂你做了什么
- 演示能在 10 分钟内展示核心能力

---

## 关键原则

1. **MVP 优先**：不追求完美，先做出能跑的版本
2. **问题驱动**：每个阶段都在解决上一个阶段暴露的问题
3. **可观测**：看不见就改不了，观测性是基础
4. **可迭代**：根据数据优化，不是凭感觉
5. **真实场景**：写小说是真实的、可评估的、复杂度够的场景

---

## 不做什么

1. **不做多 Agent 协作**：MVP 只需要单 Agent
2. **不做复杂的回滚机制**：简单的版本管理就够了
3. **不做自动评估**：人工评估质量就够了（后面可以加）
4. **不做长篇小说**：短篇就能练到所有核心能力
5. **不做 RAG**：MVP 不需要外部知识库（后面可以加）

---

## 技术栈

- **LangChain**：Agent 核心、Memory、Prompt 管理
- **LangGraph**：状态管理、流程编排（可选，如果 LangChain 的 Memory 够用就不用）
- **Python**：开发语言
- **日志**：结构化日志（JSON）
- **存储**：本地文件（状态、日志、生成的小说）

---

## 成功标准

3 个月后，你能：
1. 演示一个完整的写小说 Agent
2. 解释每个模块的设计和实现
3. 展示观测性和迭代优化的效果
4. 回答"企业级 Agent 和普通 Agent 的区别"

这就是企业级 Agent 的核心能力。
